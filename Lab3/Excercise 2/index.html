<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Smart Shopping Cart</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f8f9fa; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: auto; display: grid; grid-template-columns: 1fr 350px; gap: 20px; }
        
        /* Product List */
        .product-list { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .product-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; }
        
        /* Cart Styles */
        .cart-panel { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); height: fit-content; }
        .cart-item { font-size: 14px; margin-bottom: 10px; display: flex; justify-content: space-between; }
        
        /* Discount Indicators */
        .discount-tag { color: #28a745; font-size: 12px; font-weight: bold; }
        .original-price { text-decoration: line-through; color: #999; margin-right: 5px; }

        input[type="text"] { width: 70%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { cursor: pointer; border: none; border-radius: 4px; padding: 8px 12px; transition: 0.3s; }
        .btn-add { background: #007bff; color: white; }
        .btn-remove { background: #dc3545; color: white; padding: 4px 8px; font-size: 12px; }
        .summary { border-top: 2px solid #eee; margin-top: 20px; padding-top: 15px; }
        .total-row { font-size: 18px; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="product-list">
        <h2>Available Products</h2>
        <div id="catalog">
            </div>
    </div>

    <div class="cart-panel">
        <h2>Shopping Cart</h2>
        <div id="cartItems">
            <p style="color:#999">Cart is empty</p>
        </div>

        <div class="summary">
            <div class="input-group">
                <input type="text" id="couponInput" placeholder="Enter Coupon (e.g. SAVE10)">
                <button onclick="applyCoupon()">Apply</button>
            </div>
            <p id="discountMsg" class="discount-tag"></p>
            <div class="total-row">Total: $<span id="cartTotal">0.00</span></div>
        </div>
    </div>
</div>

<script>
    // 1. Initial Product Data
    const products = [
        { id: 1, name: "Laptop", price: 1000, category: "Electronics" },
        { id: 2, name: "Headphones", price: 150, category: "Electronics" },
        { id: 3, name: "Coffee Mug", price: 20, category: "Home" },
        { id: 4, name: "Notebook", price: 10, category: "Stationery" }
    ];

    let cart = [];
    let activeCoupon = null;

    // 2. Initialize Catalog
    function renderCatalog() {
        const catalogDiv = document.getElementById('catalog');
        catalogDiv.innerHTML = products.map(p => `
            <div class="product-item">
                <div>
                    <strong>${p.name}</strong><br>
                    <small>${p.category} | $${p.price}</small>
                </div>
                <button class="btn-add" onclick="addToCart(${p.id})">Add to Cart</button>
            </div>
        `).join('');
    }

    // 3. Cart Logic
    function addToCart(productId) {
        const product = products.find(p => p.id === productId);
        const existing = cart.find(item => item.id === productId);

        if (existing) {
            existing.quantity++;
        } else {
            cart.push({ ...product, quantity: 1 });
        }
        updateUI();
    }

    function removeFromCart(productId) {
        cart = cart.filter(item => item.id !== productId);
        updateUI();
    }

    function updateQuantity(productId, delta) {
        const item = cart.find(i => i.id === productId);
        if (item) {
            item.quantity += delta;
            if (item.quantity <= 0) removeFromCart(productId);
        }
        updateUI();
    }

    // 4. Rule-Driven Discount Calculation
    function calculateTotal() {
        let subtotal = 0;
        let totalDiscount = 0;

        cart.forEach(item => {
            let itemPrice = item.price * item.quantity;
            
            // Rule 1: Bulk Discount (10% off if quantity > 3 of same item)
            if (item.quantity >= 3) {
                itemPrice *= 0.90;
            }

            // Rule 2: Category Discount (5% off Electronics)
            if (item.category === "Electronics") {
                itemPrice *= 0.95;
            }

            subtotal += itemPrice;
        });

        // Rule 3: Time-based Discount (Happy Hour: 4 PM - 6 PM gives 10% off total)
        const currentHour = new Date().getHours();
        if (currentHour >= 16 && currentHour <= 18) {
            subtotal *= 0.90;
            document.getElementById('discountMsg').innerText = "Happy Hour Discount Applied (10%)!";
        } else {
            document.getElementById('discountMsg').innerText = "";
        }

        // Rule 4: Coupon Code Logic
        if (activeCoupon === "SAVE10") {
            subtotal *= 0.90;
        }

        return subtotal.toFixed(2);
    }

    // 5. Coupon String Validation
    function applyCoupon() {
        const code = document.getElementById('couponInput').value.trim().toUpperCase();
        
        // String methods to validate: must start with 'SAVE' and have numbers
        if (code.startsWith("SAVE") && code.length > 4) {
            activeCoupon = code;
            alert("Coupon Applied Successfully!");
        } else {
            alert("Invalid Coupon Code Format.");
            activeCoupon = null;
        }
        updateUI();
    }

    // 6. Real-time DOM Update
    function updateUI() {
        const cartItemsDiv = document.getElementById('cartItems');
        const cartTotalSpan = document.getElementById('cartTotal');

        if (cart.length === 0) {
            cartItemsDiv.innerHTML = '<p style="color:#999">Cart is empty</p>';
        } else {
            cartItemsDiv.innerHTML = cart.map(item => `
                <div class="cart-item">
                    <span>${item.name} x${item.quantity}</span>
                    <span>
                        $${(item.price * item.quantity).toFixed(2)}
                        <button class="btn-remove" onclick="updateQuantity(${item.id}, -1)">-</button>
                        <button class="btn-remove" style="background:#28a745" onclick="updateQuantity(${item.id}, 1)">+</button>
                        <button class="btn-remove" onclick="removeFromCart(${item.id})">Remove</button>
                    </span>
                </div>
            `).join('');
        }

        cartTotalSpan.innerText = calculateTotal();
    }

    renderCatalog();
</script>

</body>
</html>