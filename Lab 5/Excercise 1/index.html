<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Employee Management System (XML AJAX)</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: #f4f4f9; }
        .box { max-width: 900px; margin: auto; background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .form-row { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 5px; flex: 1; }
        button { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .add-btn { background: #2ecc71; color: white; }
        .del-btn { background: #e74c3c; color: white; padding: 5px 10px; }
        .upd-btn { background: #3498db; color: white; padding: 5px 10px; margin-right: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #eee; padding: 12px; text-align: left; }
        th { background: #34495e; color: white; }
        .status { padding: 10px; margin-bottom: 10px; border-radius: 5px; font-weight: bold; display: none; }
        .success { background: #d4edda; color: #155724; display: block; }
        .error { background: #f8d7da; color: #721c24; display: block; }
    </style>
</head>
<body>

<div class="box">
    <h2>Employee Records (XML AJAX CRUD)</h2>
    
    <div id="statusMsg" class="status"></div>

    <div class="form-row">
        <input type="text" id="eid" placeholder="Employee ID">
        <input type="text" id="ename" placeholder="Name">
        <input type="text" id="edept" placeholder="Department">
        <input type="number" id="esal" placeholder="Salary">
        <button class="add-btn" onclick="createEmployee()">Add Record</button>
    </div>

    <table id="employeeTable">
        <thead>
            <tr>
                <th>ID</th><th>Name</th><th>Dept</th><th>Salary</th><th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>



<script>
    let xmlDoc = null;

    // Requirement: Use AJAX to fetch records
    function fetchXML() {
        const xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4) {
                if (this.status == 200) {
                    // Requirement: Use responseXML
                    xmlDoc = this.responseXML;
                    
                    // Requirement: Handle Malformed XML errors
                    if (!xmlDoc || xmlDoc.getElementsByTagName("parsererror").length > 0) {
                        showStatus("Error: Malformed XML file detected.", "error");
                        return;
                    }
                    readEmployees();
                } else {
                    showStatus("Error: Could not load XML file (Status: " + this.status + ")", "error");
                }
            }
        };
        xhttp.open("GET", "employees.xml", true);
        xhttp.send();
    }

    // Requirement: Read → Display using getElementsByTagName()
    function readEmployees() {
        const tbody = document.querySelector("#employeeTable tbody");
        tbody.innerHTML = "";
        
        const employees = xmlDoc.getElementsByTagName("employee");

        // Requirement: Handle empty XML
        if (employees.length === 0) {
            tbody.innerHTML = "<tr><td colspan='5' style='text-align:center'>No records found.</td></tr>";
            return;
        }

        for (let i = 0; i < employees.length; i++) {
            const id = employees[i].getElementsByTagName("id")[0].textContent;
            const name = employees[i].getElementsByTagName("name")[0].textContent;
            const dept = employees[i].getElementsByTagName("dept")[0].textContent;
            const salary = employees[i].getElementsByTagName("salary")[0].textContent;

            tbody.innerHTML += `<tr>
                <td>${id}</td>
                <td>${name}</td>
                <td>${dept}</td>
                <td>$${salary}</td>
                <td>
                    <button class="upd-btn" onclick="updateEmployee(${i})">Edit</button>
                    <button class="del-btn" onclick="deleteEmployee(${i})">Delete</button>
                </td>
            </tr>`;
        }
    }

    // Requirement: Create → Add new node dynamically
    function createEmployee() {
        const id = document.getElementById('eid').value.trim();
        const name = document.getElementById('ename').value.trim();
        const dept = document.getElementById('edept').value.trim();
        const salary = document.getElementById('esal').value.trim();

        if (!id || !name || !dept || !salary) {
            showStatus("Validation Error: Please fill all fields.", "error");
            return;
        }

        const newEmp = xmlDoc.createElement("employee");
        
        const fields = { id, name, dept, salary };
        for (let key in fields) {
            const node = xmlDoc.createElement(key);
            node.textContent = fields[key];
            newEmp.appendChild(node);
        }

        xmlDoc.documentElement.appendChild(newEmp);
        readEmployees();
        showStatus("Success: Employee record created!", "success");
        clearForm();
    }

    // Requirement: Update → Modify salary or department
    function updateEmployee(index) {
        const employees = xmlDoc.getElementsByTagName("employee");
        const emp = employees[index];
        
        const choice = prompt("Update (1) Salary or (2) Department? Enter 'salary' or 'dept':").toLowerCase();
        
        if (choice === 'salary') {
            const newVal = prompt("Enter new salary:");
            if (newVal) {
                emp.getElementsByTagName("salary")[0].textContent = newVal;
                showStatus("Success: Salary modified.", "success");
            }
        } else if (choice === 'dept') {
            const newVal = prompt("Enter new department:");
            if (newVal) {
                emp.getElementsByTagName("dept")[0].textContent = newVal;
                showStatus("Success: Department modified.", "success");
            }
        } else {
            alert("Update cancelled or invalid input.");
        }
        
        readEmployees();
    }

    // Requirement: Delete → Remove employee node
    function deleteEmployee(index) {
        if (confirm("Are you sure you want to delete this record?")) {
            const employees = xmlDoc.getElementsByTagName("employee");
            xmlDoc.documentElement.removeChild(employees[index]);
            readEmployees();
            showStatus("Success: Employee record deleted.", "success");
        }
    }

    function showStatus(text, type) {
        const msg = document.getElementById('statusMsg');
        msg.innerText = text;
        msg.className = "status " + type;
        setTimeout(() => msg.className = "status", 4000);
    }

    function clearForm() {
        document.querySelectorAll('input').forEach(i => i.value = "");
    }

    // Initialize
    fetchXML();
</script>
</body>
</html>